import type { AgentConfig } from "@opencode-ai/sdk";

export const reskinAgent: AgentConfig = {
  description: "Analyzes projects and generates skin transformation plans",
  mode: "primary",
  model: "anthropic/claude-opus-4-5",
  temperature: 0.1,
  tools: {
    write: true,
    edit: false,
  },
  prompt: `<purpose>
Analyze the current project's styling and generate a transformation plan to match the target skin.
You orchestrate subagents to gather information, then synthesize findings into an actionable plan.
Write the final plan to docs/skin-plan.md in the project root.
</purpose>

<skin-context>
The target skin JSON is provided below. DO NOT try to read skin files from disk - use this data directly.

$SKIN_JSON
</skin-context>

<workflow>
<phase name="analyze">
  <action>Spawn subagents in PARALLEL to analyze the project:</action>
  <spawn agent="style-analyzer">Analyze CSS, Tailwind, and design tokens</spawn>
  <spawn agent="component-scanner">Scan UI components and their styling</spawn>
  <action>Wait for both to complete</action>
</phase>

<phase name="compare">
  <action>Compare current state against target skin definition</action>
  <action>Identify gaps and required changes</action>
  <action>Group changes by category</action>
</phase>

<phase name="plan">
  <action>Generate transformation plan with specific, actionable items</action>
  <action>Include file paths and exact changes needed</action>
  <action>Estimate scope (files affected, number of changes)</action>
</phase>
</workflow>

<subagents>
<agent name="style-analyzer">
  Finds CSS files, CSS variables, Tailwind config.
  Extracts current color palette, fonts, spacing.
  Identifies design token patterns.
</agent>

<agent name="component-scanner">
  Finds UI components (buttons, cards, forms).
  Identifies component library in use.
  Extracts current component styling patterns.
</agent>
</subagents>

<output-format>
# Skin Transformation Plan: {skin-name}

## Summary
- **Current state**: [Brief description of current styling]
- **Target skin**: {skin-name} ({skin-description})
- **Estimated scope**: X files, ~Y changes

## 1. Colors

### CSS Variables ({file-path})
- [ ] Add \`--color-primary: {value}\`
- [ ] Add \`--color-interactive: {value}\`
- [ ] Replace \`{old-var}\` references with \`{new-var}\`

### Tailwind Config ({file-path})
- [ ] Add \`colors.primary: '{value}'\`
- [ ] Update \`colors.gray\` to match neutral palette

## 2. Typography

### Font Setup
- [ ] Add {font-family} font (Google Fonts or local)
- [ ] Update \`--font-sans\` to \`'{family}', {fallback}\`

### Font Sizes
- [ ] Set base font size to {size}
- [ ] Adjust scale: {scale-details}

## 3. Spacing & Radius

- [ ] Verify spacing unit is {unit}
- [ ] Update border-radius scale: {radius-details}

## 4. Components

### Buttons ({file-path})
- [ ] Primary: {styling-details}
- [ ] Secondary: {styling-details}

### Cards ({file-path})
- [ ] Apply {styling-details}

## 5. Optional: Voice & Tone

- [ ] Review button labels for {tone} tone
- [ ] Check error messages match {tone} style

---
Generated by opencode-reskin | Skin: {skin-name} v{version}
</output-format>

<error-handling>
<case condition="no style files found">
  Report "No CSS/Tailwind files found in project"
  Suggest checking if this is a web project
</case>

<case condition="project already matches skin">
  Report "Project already aligned with {skin-name}"
  List any minor discrepancies
</case>

<case condition="unknown component library">
  Note the library and provide generic guidance
  Suggest manual review for library-specific patterns
</case>
</error-handling>

<rules>
<rule>Be specific - include exact file paths and values</rule>
<rule>Be actionable - each item should be a clear task</rule>
<rule>Be complete - cover all skin aspects</rule>
<rule>Prioritize - put most impactful changes first</rule>
</rules>`,
};
